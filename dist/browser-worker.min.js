!function(){var e=function(e){return e&&e.__esModule?e:{default:e}},t=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},r={};Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=class{static hasCacheApi(){return caches instanceof CacheStorage}static hasServiceWorkerApi(){return"serviceWorker"in navigator}};var a={};Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;a.default=class{static nameIsValid(e){return"string"==typeof e}static nameIsFilled(e){return e.trim().length>0}};var s={};Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=e(t);class o{static getSupportedStrategies(){return[o.NETWORK_FIRST,o.CACHE_FIRST,o.CACHE_ONLY]}static isValid(e){return"string"==typeof e}static isFilled(e){return e.trim().length>0}static isSupported(e){return o.getSupportedStrategies().includes(e)}}(0,i.default)(o,"NETWORK_FIRST","network-first"),(0,i.default)(o,"CACHE_FIRST","cache-first"),(0,i.default)(o,"CACHE_ONLY","cache-only");var n=o;s.default=n;var c={};Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;class u{static _getDisplayMessage(e){const t=new Date;return`[BrowserWorker][${`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}.${t.getMilliseconds()}`}] ${e}`}static displayInfo(e){u._displayMessage(e,"info")}static displayError(e){u._displayMessage(e,"error")}static displayWarning(e){u._displayMessage(e,"warn")}static _displayMessage(e,t){u.debugEnabled()&&console[t](u._getDisplayMessage(e))}static enableDebug(){u._debug=!0}static disableDebug(){u._debug=!1}static debugEnabled(){return u._debug}}(0,e(t).default)(u,"_debug",!1);var l=u;c.default=l;var d={};Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var f=e(c);d.default=class{static getFromCacheFirst(e,t){e.respondWith(caches.match(e.request).then(function(r){return r?(f.default.displayInfo(`[CacheFirst] fetched ${e.request.url} from the cache`),r):fetch(e.request).then(function(r){if(!r||200!==r.status||"basic"!==r.type)return r;const a=r.clone();return caches.open(t).then(function(t){t.put(e.request,a)}),f.default.displayInfo(`[CacheFirst] No cache found for ${e.request.url}, so the resource have been fetched from the network and stored in cache`),r})}))}static getFromNetworkFirst(e,t){e.respondWith(fetch(e.request).then(r=>{if(r.ok)return caches.open(t).then(t=>t.put(e.request,r.clone())),f.default.displayInfo(`[NetworkFirst] fetched ${e.request.url} from the network (and put it in the cache)`),r.clone();throw new Error}).catch(()=>(f.default.displayInfo(`[NetworkFirst] fetched ${e.request.url} from the cache because it seems the network is down`),caches.match(e.request))))}static getFromCacheOnly(e,t){e.respondWith(caches.match(e.request).then(function(t){if(t)return f.default.displayInfo(`[CacheOnly] fetched ${e.request.url} from the cache`),t;f.default.displayWarning(`[CacheOnly] No cache found for ${e.request.url}, cannot return a response.`)}))}};var h={};Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var g=e(t);class p{constructor(e){this.route=e}matches(e){return this.matchesByString(e)||this.matchesByRegExp(e)}matchesByString(e){return"string"==typeof this.route&&e.endsWith(this.route)}matchesByRegExp(e){return this.route instanceof RegExp&&this.route.test(e)}static isValid(e){return null!=e&&("string"==typeof e||e instanceof RegExp)}static isFilled(e){return"string"==typeof e&&e.trim().length>0||e instanceof RegExp&&e.toString()!==(new RegExp).toString()}}(0,g.default)(p,"IMAGES",/\.(png|jpg|jpeg|gif|svg|webp)(\?.*)*$/i),(0,g.default)(p,"VIDEOS",/\.(mp4|ogv|ogg|webm|flv|3gp|mkv)(\?.*)*$/i),(0,g.default)(p,"AUDIOS",/\.(wav|mp3|ogg)(\?.*)*$/i),(0,g.default)(p,"ASSETS",/\.(js|css|html|htm)(\?.*)*$/i),(0,g.default)(p,"FONTS",/\.(woff|woff2|ttf|eot)(\?.*)*$/i);var y=p;h.default=y;var _={};Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var v=e(t),w=e(r),b=e(a),m=e(s),S=e(c),R=e(d),C=e(h);class k{static enableControlOverAllTabs(){return this._controlOverAllTabs=!0,this}static disableWaitingOtherInstances(){return this._waitOtherInstances=!1,this}static enableWaitingOtherInstances(){return this._waitOtherInstances=!0,this}static setCacheStrategy(e){const t=m.default.getSupportedStrategies();if(!m.default.isValid(e))throw new TypeError(`expected strategy to be a string (${typeof e} given)`);if(!m.default.isFilled(e))throw new Error("expected strategy not to be empty");if(!m.default.isSupported(e)){const r=t.join(", ");throw new Error(`unsupported strategy ${e} (use one of the following: ${r})`)}return k._cacheStrategy=e,this}static getCacheStrategy(){return k._cacheStrategy}static addRoute(e){if(!C.default.isValid(e))throw new TypeError(`expected route to be either string or regexp (${typeof e} given)`);if(!C.default.isFilled(e))throw new Error("expected route string not to be empty");return k._routes.push({strategy:k._cacheStrategy,route:e,cacheName:k._currentCacheName}),k._cacheStrategy===m.default.CACHE_ONLY&&"string"==typeof e&&k.addResourceToCache(e),this}static addRoutes(e){for(const t of e)k.addRoute(t);return this}static getRoutes(){return k._routes}static deleteRoute(e){if(!C.default.isValid(e))throw new TypeError(`expected route to be either string or regexp (got: ${typeof e})`);if(!C.default.isFilled(e))throw new Error("expected route not to be empty");return k._routes=k._routes.filter(t=>t.route!==e),this}static deleteRoutes(e){for(const t of e)k.deleteRoute(t);return this}static hasRoute(e){for(const t of k._routes)if(t.route===e)return!0;return!1}static setCacheName(e){if(!b.default.nameIsValid(e))throw new TypeError(`expected cache name to be a string (got: ${typeof e})`);if(!b.default.nameIsFilled(e))throw new Error("expected cache name not to be empty");const t=e+k._cacheSuffix;return k._currentCacheName=t,k._activeCachesName.push(t),this}static setServiceWorkerPath(e){return k._serviceWorkerPath=e,this}static registerServiceWorker(){w.default.hasServiceWorkerApi()&&navigator.serviceWorker.register(k._serviceWorkerPath).then(e=>{S.default.displayInfo(`service worker registered (scope: ${e.scope}).`)}).catch(function(e){S.default.displayError("an error occured while registering your service worker."),S.default.displayError(e)})}static async removeServiceWorker(){if(w.default.hasServiceWorkerApi()){const e=(await navigator.serviceWorker.getRegistrations()).map(e=>e.unregister()),t=await Promise.all(e),r=t.filter(e=>!0===e).length,a=t.filter(e=>!1===e).length;S.default.displayInfo(`${r} service workers removed, ${a} service worker removals failed`)}else S.default.displayWarning("service workers are not supported in your browser");return this}static async removeCaches(){if(w.default.hasCacheApi()){const e=(await caches.keys()).filter(e=>e.endsWith(k._cacheSuffix)).map(e=>caches.delete(e)),t=await Promise.all(e),r=t.filter(e=>!0===e).length,a=t.filter(e=>!1===e).length;S.default.displayInfo(`${r} caches removed, ${a} cache removals failed`)}else S.default.displayWarning("the caches API is not supported in your browser");return this}static async addResourceToCache(e){w.default.hasCacheApi()?(await caches.open(k._currentCacheName)).add(e):S.default.displayWarning("the Cache API is not supported in your browser")}static async addResourcesToCache(e){const t=e.map(e=>k.addResourceToCache(e));await Promise.all(t)}static listenRequests(){k._activateServiceWorker(),k._installServiceWorker(),k._listenRequests()}static enableDebug(){return S.default.enableDebug(),this}static disableDebug(){return S.default.disableDebug(),this}static debugEnabled(){return S.default.debugEnabled()}static reset(){return k._cacheStrategy="",k._cacheSuffix="-browser-worker",k._currentCacheName="",k._activeCachesName=[],k._routes=[],k._currentRoute="",k._waitOtherInstances=!0,k._controlOverAllTabs=!1,k._serviceWorkerPath="/service-worker.js",this}static resetCacheStrategy(){return k._cacheStrategy="",this}static resetRoutes(){return k._routes=[],this}static _setCurrentRoute(e){for(const t of k._routes)if(new C.default(t.route).matches(e)){k._currentRoute=t;break}}static _currentRouteStrategyIs(e){return k._currentRoute&&k._currentRoute.strategy===e}static _currentRouteValid(){return null!==k._currentRoute&&void 0!==k._currentRoute&&!1===Array.isArray(k._currentRoute)&&"object"==typeof k._currentRoute}static _currentRouteMatches(e){const t=new C.default(k._currentRoute.route);return k._currentRouteValid()&&(t.matchesByString(e)||t.matchesByRegExp(e))}static _getCurrentRouteCacheName(){return k._currentRoute.cacheName}static _activateServiceWorker(){self.addEventListener("activate",e=>{this._controlOverAllTabs?(clients.claim(),S.default.displayInfo("controlling all tabs.")):S.default.displayError("controlling only this tab (if you want to controll all tabs, use BrowserWorker.enableControlOverAllTabs())"),e.waitUntil(caches.keys().then(function(e){return Promise.all(e.filter(e=>!k._activeCachesName.includes(e)).map(e=>caches.delete(e)),S.default.displayInfo("cleaned old caches."))}))})}static _installServiceWorker(){self.addEventListener("install",()=>{this._waitOtherInstances?S.default.displayInfo("waiting for others instances before installing (if you want to skip waiting, use BrowserWorker.disableWaitingOtherInstances())"):(self.skipWaiting(),S.default.displayInfo("skipped waiting for other instances to finish."))})}static _listenRequests(){self.addEventListener("fetch",async e=>{k._setCurrentRoute(e.request.url),k._currentRouteMatches(e.request.url)?k._currentRouteStrategyIs(m.default.NETWORK_FIRST)?R.default.getFromNetworkFirst(e,k._getCurrentRouteCacheName()):k._currentRouteStrategyIs(m.default.CACHE_FIRST)?R.default.getFromCacheFirst(e,k._getCurrentRouteCacheName()):k._currentRouteStrategyIs(m.default.CACHE_ONLY)?R.default.getFromCacheOnly(e,w.default._getCurrentRouteCacheName):S.default.displayWarning(`unsupported strategy ${k._currentRoute.strategy}`):S.default.displayInfo(`resource ${e.request.url} do not match any strategy, leaving the browser to handle it`)})}}(0,v.default)(k,"_cacheStrategy",""),(0,v.default)(k,"_cacheSuffix","-browser-worker"),(0,v.default)(k,"_currentCacheName",""),(0,v.default)(k,"_activeCachesName",[]),(0,v.default)(k,"_routes",[]),(0,v.default)(k,"_currentRoute",{}),(0,v.default)(k,"_waitOtherInstances",!0),(0,v.default)(k,"_controlOverAllTabs",!1),(0,v.default)(k,"_serviceWorkerPath","/service-worker.js");var E=k;_.default=E;var I={};Object.defineProperty(I,"__esModule",{value:!0}),Object.defineProperty(I,"BrowserWorker",{enumerable:!0,get:function(){return W.default}}),Object.defineProperty(I,"CacheStrategy",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(I,"Route",{enumerable:!0,get:function(){return N.default}});var W=e(_),O=e(s),N=e(h);window.BrowserWorker=I.BrowserWorker}();